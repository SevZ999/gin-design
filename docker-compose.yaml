services:
  gin-design-v1:
    image: crpi-nmbc0yqbbslptbxi.cn-shanghai.personal.cr.aliyuncs.com/sevz98/gin-design:v1.0.1 # å›ºå®šé•œåƒç‰ˆæœ¬ï¼ˆç¦æ­¢ä½¿ç”¨latestï¼‰
    user: "1001:1001"        # å¼ºåˆ¶æŒ‡å®šérootç”¨æˆ·UID/GIDï¼ˆä¸Dockerfileä¸­åˆ›å»ºçš„nonrootç”¨æˆ·ä¸€è‡´ï¼‰
    security_opt:
      - no-new-privileges:true  # ç¦æ­¢ææƒ
    cap_drop:                  # åˆ é™¤æ‰€æœ‰ç‰¹æƒèƒ½åŠ›
      - ALL
    read_only: true            # æ–‡ä»¶ç³»ç»Ÿåªè¯»
    # tmpfs:                     # å…è®¸ä¸´æ—¶ç›®å½•å†™å…¥
    #   - /tmp:uid=1001,gid=1001,mode=1700  # é™åˆ¶/tmpç›®å½•æƒé™
    environment:
      - MODE=dev
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
    logging:                   # ğŸ”¥ æ—¥å¿—å®‰å…¨é…ç½®
      driver: json-file
      options:
        max-size: "10m"       # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§10MB
        max-file: "5"         # æœ€å¤šä¿ç•™5ä¸ªå†å²æ—¥å¿—
        compress: "true"      # å¯ç”¨å‹ç¼©èŠ‚çœç©ºé—´
        labels: "prod"        # æ·»åŠ æ—¥å¿—æ ‡ç­¾æ–¹ä¾¿è¿‡æ»¤
    volumes:
      - /usr/src/dev/gin-design/log/app:/app/logs:uid=1001,gid=1001,mode=0750
    labels:
      - "traefik.enable=true"
      # å®šä¹‰v1æœåŠ¡
      - "traefik.http.services.gin-design-v1.loadbalancer.server.port=9001"
      # å¥åº·æ£€æŸ¥
      - "traefik.http.services.gin-design-v1.loadbalancer.healthcheck.path=/health"
      - "traefik.http.services.gin-design-v1.loadbalancer.healthcheck.interval=10s"
      - "traefik.http.services.gin-design-v1.loadbalancer.healthcheck.timeout=3s"
    networks:
      - traefik_net

# volumes:
#   gin-design-logs:  # å‘½åå·ï¼ˆDockerè‡ªåŠ¨ç®¡ç†è·¯å¾„ï¼‰
#     driver: local
#     driver_opts:
#       type: "none"
#       o: "bind,uid=1001,gid=1001,mode=0750"
#       device: /usr/src/dev/gin-design/log/app  # å®¿ä¸»æœºå®é™…è·¯å¾„ï¼ˆå¯è‡ªå®šä¹‰ï¼‰

networks:
  traefik_net:
    external: true